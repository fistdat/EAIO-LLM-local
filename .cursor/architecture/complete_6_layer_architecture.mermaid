graph TB
    %% EAIO Complete 6-Layer Architecture
    
    subgraph Layer1 ["ğŸ–¥ï¸ Layer 1: User Interface Layer"]
        direction TB
        NextJS["Next.js Web App<br/>ğŸ“Š Executive Dashboard<br/>ğŸ“ˆ Manager Dashboard<br/>ğŸ”§ Analyst Dashboard"]
        Streamlit["Streamlit Analytics<br/>ğŸ“Š Deep Analytics<br/>ğŸ” BDG2 Exploration<br/>ğŸ“ˆ Custom Reports"]
        PWA["Progressive Web App<br/>ğŸ“± Mobile Interface<br/>ğŸ”” Real-time Alerts<br/>âš¡ Offline Capability"]
        NextJS -.-> PWA
        Streamlit -.-> PWA
    end
    
    subgraph Layer2 ["ğŸ§  Layer 2: Hybrid LLM Infrastructure"]
        direction TB
        HybridRouter["Hybrid LLM Router<br/>ğŸ”’ Privacy Classification<br/>ğŸ’° Cost Optimization<br/>ğŸ”„ Auto Fallback"]
        
        subgraph LocalLLM ["Local LLM Stack"]
            Ollama["Ollama Runtime<br/>ğŸ  On-device Processing"]
            Qwen["Qwen2.5-7B-Instruct<br/>ğŸ¯ Control & Safety"]
            Llama["Llama-3.2-3B-Instruct<br/>âš¡ Fast Coordination"]
        end
        
        subgraph ExternalAPI ["External LLM APIs"]
            OpenAI["OpenAI GPT-4o<br/>ğŸ§  Complex Reasoning"]
            DeepSeek["DeepSeek-V3<br/>ğŸ’¡ Optimization Strategy"]
            Gemini["Google Gemini<br/>ğŸ“Š Data Analysis"]
        end
        
        HybridRouter --> LocalLLM
        HybridRouter --> ExternalAPI
    end
    
    subgraph Layer3 ["ğŸ”Œ Layer 3: MCP Integration Layer â­ NEW"]
        direction TB
        
        subgraph MCPServers ["MCP Server Ecosystem"]
            EnergyMCP["Energy Data Server<br/>âš¡ Consumption Data<br/>ğŸ“Š Sensor Readings<br/>ğŸš¨ Anomaly Detection"]
            WeatherMCP["Weather Server<br/>ğŸŒ¤ï¸ Forecast Data<br/>ğŸ“ˆ Historical Weather<br/>ğŸŒ¡ï¸ Impact Analysis"]
            MLMCP["ML Models Server<br/>ğŸ¤– Forecasting Models<br/>ğŸ“Š Efficiency Calc<br/>ğŸ’¡ Optimization Rec"]
            ControlMCP["Building Control Server<br/>ğŸ¢ HVAC Control<br/>ğŸ’¡ Lighting Optimization<br/>âš™ï¸ Equipment Schedule"]
            BDG2MCP["BDG2 Data Server<br/>ğŸ¢ Building Benchmarks<br/>ğŸ“Š Performance Compare<br/>ğŸ“ˆ Pattern Analysis"]
        end
        
        MCPCache["MCP Tool Cache<br/>âš¡ Redis Caching<br/>ğŸ¯ Category-based TTL<br/>ğŸ“Š Performance Monitor"]
        MCPServers --> MCPCache
    end
    
    subgraph Layer4 ["ğŸ¤– Layer 4: Multi-Agent Framework â­ NEW"]
        direction TB
        
        subgraph LangGraphCore ["LangGraph Orchestration"]
            StateGraph["StateGraph Workflow<br/>ğŸ”„ State Management<br/>ğŸ›¡ï¸ Checkpointing<br/>â†©ï¸ Recovery Mechanism"]
            WorkflowStates["Workflow States<br/>ğŸ’¬ Messages State<br/>ğŸ¢ Building Context<br/>ğŸ“Š Analysis Results<br/>ğŸ§  Memory Context"]
        end
        
        subgraph AgentNetwork ["Agent Network"]
            CoordAgent["Coordinator Agent<br/>ğŸ¯ Workflow Orchestration<br/>ğŸ“‹ Task Distribution<br/>ğŸ”„ Result Integration"]
            DataAgent["Data Intelligence Agent<br/>ğŸ“Š BDG2 Analysis<br/>ğŸ” Pattern Recognition<br/>ğŸ“ˆ Historical Insights"]
            OptAgent["Optimization Strategist<br/>ğŸ’¡ Strategy Development<br/>âš¡ Energy Optimization<br/>ğŸ’° Cost Analysis"]
            ForecastAgent["Forecast Intelligence<br/>ğŸ“ˆ Predictive Modeling<br/>ğŸŒ¤ï¸ Weather Integration<br/>ğŸ“Š Trend Analysis"]
            ControlAgent["Control Coordination<br/>ğŸ¢ System Control<br/>âš™ï¸ Equipment Management<br/>ğŸ›¡ï¸ Safety Validation"]
        end
        
        LangSmith["LangSmith Monitoring<br/>ğŸ“Š Workflow Tracing<br/>ğŸ’° Cost Tracking<br/>âš¡ Performance Metrics"]
        
        StateGraph --> AgentNetwork
        AgentNetwork --> LangSmith
    end
    
    subgraph Layer5 ["ğŸ§  Layer 5: Memory Systems â­ NEW"]
        direction TB
        
        subgraph MemoryLayers ["5-Layer Memory Architecture"]
            ShortTerm["Short-term Memory<br/>ğŸ’­ Redis Cache<br/>ğŸ”„ 20 Exchanges<br/>âš¡ Immediate Context"]
            Working["Working Memory<br/>ğŸ§  Redis Buffer<br/>ğŸ“ 2000 Tokens<br/>ğŸ¯ Task Context"]
            Episodic["Episodic Memory<br/>ğŸ¢ Milvus Vectors<br/>ğŸ“Š Building Patterns<br/>ğŸ’¡ Experience Storage"]
            Semantic["Semantic Memory<br/>ğŸ“š ChromaDB<br/>ğŸ“ Domain Knowledge<br/>ğŸ“Š BDG2 Benchmarks"]
            Procedural["Procedural Memory<br/>âš™ï¸ PostgreSQL<br/>ğŸ› ï¸ Agent Skills<br/>ğŸ“‹ Procedures"]
        end
        
        MemoryManager["Memory Manager<br/>ğŸ”„ Consolidation Process<br/>ğŸ¯ Context Retrieval<br/>ğŸ“Š Pattern Extraction"]
        MemoryLayers --> MemoryManager
    end
    
    subgraph Layer6 ["ğŸ’¾ Layer 6: Data Infrastructure Layer"]
        direction TB
        
        subgraph PrimaryDB ["Primary Database"]
            PostgreSQL["PostgreSQL 16<br/>ğŸ¢ Building Metadata<br/>ğŸ‘¥ User Management<br/>ğŸ” Security Context"]
            TimescaleDB["TimescaleDB Extension<br/>âš¡ Energy Time-series<br/>ğŸ“Š BDG2 Integration<br/>ğŸš€ Optimized Queries"]
        end
        
        subgraph VectorDB ["Vector Database"]
            Milvus["Milvus Vector DB<br/>ğŸ” Similarity Search<br/>ğŸ§  Agent Memory<br/>ğŸ“Š Pattern Storage<br/>384D Embeddings"]
        end
        
        subgraph CacheLayer ["Cache Layer"]
            Redis["Redis Cache<br/>âš¡ Session Storage<br/>ğŸ”„ Real-time Updates<br/>ğŸ“Š Performance Cache"]
        end
        
        PostgreSQL -.-> TimescaleDB
    end
    
    %% Layer Connections
    Layer1 --> Layer2
    Layer2 --> Layer3
    Layer3 --> Layer4
    Layer4 --> Layer5
    Layer5 --> Layer6
    
    %% Cross-layer Integrations
    Layer4 -.-> Layer3
    Layer5 -.-> Layer6
    Layer1 -.-> Layer6
    
    %% Real-time Data Flows
    Layer6 -.-> Layer5
    Layer5 -.-> Layer4
    Layer4 -.-> Layer3
    Layer3 -.-> Layer2
    Layer2 -.-> Layer1
    
    %% Styling
    classDef layerStyle fill:#f9f9f9,stroke:#333,stroke-width:2px,color:#333
    classDef newFeature fill:#e1f5fe,stroke:#0277bd,stroke-width:3px,color:#01579b
    classDef coreComponent fill:#fff3e0,stroke:#f57c00,stroke-width:2px,color:#e65100
    classDef infrastructure fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px,color:#4a148c
    
    class Layer1,Layer2,Layer3,Layer4,Layer5,Layer6 layerStyle
    class Layer3,Layer4,Layer5 newFeature
    class NextJS,Streamlit,HybridRouter,StateGraph,MemoryManager coreComponent
    class PostgreSQL,Milvus,Redis infrastructure 